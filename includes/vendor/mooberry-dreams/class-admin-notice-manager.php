<?php
/**
 * Manages Admin Notices generated by the plugin
 *
 * @link       http://example.com
 * @since      1.0.0
 *
 * @package    Mooberry_Directory
 * @subpackage Mooberry_Directory/includes/vendor/mooberry-dreams
 */

/**
 * Manages Admin Notices generated by the plugin
 *
 * Maintains a list of admin notices generated by the plugin.
 * Display them and dismiss as needed.
 *
 * @package    Mooberry_Directory
 * @subpackage Mooberry_Directory/includes/vendor/mooberry-dreams
 * @author     Mooberry Dreams <mooberrydreams@mooberrydreams.com>
 */
class MOOBD_Admin_Notice_Manager {

	/**
	 * The array of notices this plugin generates
	 *
	 * @since    1.0.0
	 * @access   private
	 * @var      array    $plugins    The notices this plugin generates
	 */
	private $notices;

	private $options_key;

	/**
	 * Initialize the collection used to maintain the notices.
	 *
	 * @since    1.0.0
	 */
	public function __construct() {
		$this->options_key = 'costume_con_archives_admin_notices';
		$this->load_notices();

	}

	private function load_notices() {
		$notices = get_option( $this->options_key, array() );
		if ( !is_array($notices) ) {
			$notices = array( $notices );
		}
		$this->notices = $notices;
	}

	public function get_notice( $key ) {
		return $this->notices[ $key ];
	}

	public function count_notices() {
		return count( $this->notices );
	}

	/**
	 * Add a new notice to the collection and saves it to the database
	 *
	 * @since    1.0.0
	 * @param    string               $message    The message to display
	 * @param    string               $severity   The severity/type of notice to be displayed
	 * @param    string               $key        A unique key for the notice
	 */
	public function add_new( $message, $severity, $key ) {
		$this->notices[ $key ] = array(
						'message'   =>  $message,
						'severity'  =>  $severity,
						'key'   =>  $key
		);
		$this->save();
	}

	/**
	 *  Remove a notice and update the database
	 *
	 * @param string                $key        the notice to remove
	 */
	public function dismiss( $key ) {
		unset( $this->notices[ $key ] );
		$this->save();
	}


	/**
	 * Saves all notices to the database
	 */
	private function save() {
		update_option( $this->options_key, $this->notices );
	}

	/**
	 * Display all of the notices
	 *
	 * @since    1.0.0
	 */
	public function display_notices() {
		foreach ( $this->notices as $notice ) {
			$severity = isset($notice['severity']) ? $notice['severity'] : '';
			$key = isset($notice['key']) ? $notice['key'] : '';
			$message = isset( $notice[ 'message' ] ) ? $notice[ 'message' ] : '';

			if ( $severity == '' || $key == '' || $message == '' ) {
				continue;
			}

			echo "<div class='notice " . esc_attr( $severity ) . "' id='" . esc_attr( $key ) . "'><p>" . esc_attr( $message ) . "</p></div>";
		}
	}

}
